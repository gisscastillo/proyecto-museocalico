<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galería | Museo Cálico</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;1,400&family=Lora:ital@0;1&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <script>
        // Si no hay token, redirigir al login
        if (!localStorage.getItem('token')) {
            window.location.href = 'auth.html';
        }
    </script>
</head>

<body>
    <header class="hero" style="height: 40vh; min-height: 300px;">
        <nav class="navbar">
            <div class="logo">MUSEO CÁLICO</div>
            <ul class="nav-links">
                <li><a href="#" onclick="cerrarSesion()">Cerrar Sesión</a></li>
            </ul>
        </nav>
        <div class="hero-content">
            <h1>GALERÍA</h1>
            <p>Bienvenido a tu espacio de apreciación artística</p>
        </div>
    </header>

    <main class="parchment-bg">
        <section class="about container">
            <div class="gallery-plate">
                <div class="plate-content">
                    <h2>Nuestra Misión</h2>
                    <p>Promover el acceso al arte a través de programas educativos y actividades que fomenten la apreciación artística en la comunidad global.</p>
                </div>
            </div>

            <div class="gallery-plate">
                <div class="plate-content">
                    <h2>Nuestra Visión</h2>
                    <p>Ser un referente cultural que inspire a nuevas generaciones y fortalezca el valor del arte como motor de identidad social.</p>
                </div>
            </div>
        </section>

        <section id="proyectos" class="container">
            <h2 class="section-title">EXPERIENCIAS DESTACADAS</h2>
            <div class="gallery-grid">
                <article class="art-card">
                    <div class="frame">
                        <img src="https://i.pinimg.com/736x/f2/50/28/f250284e97797a2710edc9252a377a9a.jpg" alt="Pintura">
                        <div class="overlay"><p>Colección de maestros del Renacimiento.</p></div>
                    </div>
                    <h3>Pintura Clásica</h3>
                </article>

                <article class="art-card">
                    <div class="frame">
                        <img src="https://i.pinimg.com/1200x/d6/05/8a/d6058aaf18506c8f40b41395c054c9b8.jpg" alt="Escultura">
                        <div class="overlay"><p>Exploración de formas contemporáneas.</p></div>
                    </div>
                    <h3>Escultura</h3>
                </article>

                <article class="art-card">
                    <div class="frame">
                        <img src="https://i.pinimg.com/1200x/20/15/fd/2015fd55c15659df7fa0ff39c8f913cc.jpg" alt="Talleres">
                        <div class="overlay"><p>Cursos prácticos de óleo y acuarela.</p></div>
                    </div>
                    <h3>Talleres de Arte</h3>
                </article>

                <article class="art-card">
                    <div class="frame">
                        <img src="https://i.pinimg.com/736x/2f/87/76/2f87769a6a415c8cf11e44f86d6723b7.jpg" alt="Joyas">
                        <div class="overlay"><p>Piezas históricas de orfebrería.</p></div>
                    </div>
                    <h3>Historia de la Joyería</h3>
                </article>

                <article class="art-card">
                    <div class="frame">
                        <img src="https://i.pinimg.com/1200x/0b/bd/e1/0bbde19177188dfe7d82044b73cc22a1.jpg" alt="Arquitectura">
                        <div class="overlay"><p>Recorrido por el diseño del edificio.</p></div>
                    </div>
                    <h3>Arquitectura</h3>
                </article>

                <article class="art-card">
                    <div class="frame">
                        <img src="https://i.pinimg.com/736x/8b/3c/a5/8b3ca5551223e17410e962e3ab811823.jpg" alt="Internacional">
                        <div class="overlay"><p>Obras de artistas de todo el mundo.</p></div>
                    </div>
                    <h3>Galería Global</h3>
                </article>
            </div>
        </section>

        <section id="contacto" class="container booking-combined" style="margin-top: 80px; padding-bottom: 80px;">
            <div class="gallery-plate schedule-card">
                <div class="plate-content">
                    <i class="fa-regular fa-clock schedule-icon"></i>
                    <h2>Horarios de Galería</h2>
                    <div class="schedule-grid">
                        <div class="day-row"><span>Lunes a Viernes</span><span class="dots"></span><span>09:00 - 19:00</span></div>
                        <div class="day-row"><span>Sábados</span><span class="dots"></span><span>10:00 - 20:00</span></div>
                        <div class="day-row highlight"><span>Domingos</span><span class="dots"></span><span>11:00 - 16:00</span></div>
                    </div>
                    <p class="schedule-note">* Durante los días festivos el museo permanece cerrado.</p>
                    <div class="address-box">
                        <i class="fa-solid fa-location-dot"></i>
                        <p>
                            Calle de las Artes #196, Distrito Cultural<br>
                            Ciudad de México, CP 06090
                        </p>
                    </div>
                </div>
            </div>

            <div class="gold-frame form-wrapper">
                <div class="inner-content">
                    <h2>Reservación de Boletos</h2>
                    <form id="reservationForm" class="ticket-form">
                        <div class="form-row">
                            <input type="text" id="nombre" placeholder="Nombre" required>
                            <input type="text" id="apellido" placeholder="Apellido" required>
                        </div>
                        <div class="form-row">
                            <input type="tel" id="telefono" placeholder="Teléfono" required>
                            <input type="email" id="correo" placeholder="Correo" required>
                        </div>
                        <div class="form-row">
                            <div class="input-group"><label>Fecha</label><input type="date" id="fecha" required></div>
                            <div class="input-group"><label>Cantidad</label><input type="number" id="cantidad" min="1" required></div>
                        </div>
                        <button type="submit" class="btn-gold">CONFIRMAR RESERVA</button>
                    </form>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <p>&copy; 2026 Museo Cálico de Pintura y Escultura. Todos los derechos reservados.</p>
    </footer>

    <script>
        document.getElementById('reservationForm').onsubmit = async (e) => {
            e.preventDefault();
            const token = localStorage.getItem('token');

            // Mapeamos los datos para que coincidan con la tabla 'reservas'
            const datos = {
                nombre: document.getElementById('nombre').value + " " + document.getElementById('apellido').value,
                email: document.getElementById('correo').value,
                fecha: document.getElementById('fecha').value,
                hora: "10:00", // Valor por defecto ya que no hay input de hora
                personas: parseInt(document.getElementById('cantidad').value)
            };

            try {
                // CORRECCIÓN: Ruta relativa para Render y endpoint de reservas
                const res = await fetch('/api/reservas/crear', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}` 
                    },
                    body: JSON.stringify(datos)
                });

                if (res.ok) {
                    alert('¡Reserva confirmada con éxito!');
                    document.getElementById('reservationForm').reset();
                } else {
                    const errorData = await res.json();
                    alert('Error: ' + (errorData.mensaje || 'Inicie sesión de nuevo.'));
                    if (res.status === 401) window.location.href = 'auth.html';
                }
            } catch (err) {
                alert('Servidor no disponible. Revisa tu conexión.');
            }
        };

        function cerrarSesion() {
            localStorage.removeItem('token');
            window.location.href = 'auth.html';
        }
    </script>
</body>
</html>
